(function(){"use strict";var e={1096:function(e,t,n){var l=n(9242),a=n(3396);const o=(0,a.Uk)(" window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WKB857318N'); ");function r(e,t,n,l,r,u){const i=(0,a.up)("flight-view");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(i),((0,a.wg)(),(0,a.j4)((0,a.LL)("script"),null,{default:(0,a.w5)((()=>[o])),_:1}))],64)}const u=(0,a._)("h1",null,"今天航班熔断了吗？",-1),i=(0,a._)("hr",null,null,-1),s=(0,a.Uk)("民航局文件"),d=(0,a._)("p",null,[(0,a.Uk)("不考虑奖励航班和控制客座率措施。"),(0,a._)("strong",null,"仅供参考！")],-1),c=(0,a.Uk)(" 首个航班入境日期："),h=(0,a._)("br",null,null,-1),m=(0,a.Uk)(" 周数："),g=(0,a._)("p",null,[(0,a.Uk)("图例：日期，取消开关，阳性数量 -> 熔断状态，航班状态 "),(0,a._)("br"),(0,a.Uk)(" 地区提示：美国：航司可能对航班进行"),(0,a._)("a",{href:"https://piao.tips/7bc7e7ee15/",target:"_blank"},"「规律性取消」"),(0,a.Uk)("，可使用航班卡片中的开关手动取消特定航班。")],-1),p=(0,a._)("p",null,"正常：航班状态正常（0~4 例阳性，不触发熔断）",-1),f=(0,a._)("p",null,"小熔断：5~9 例阳性，触发航班入境第四周起的 2 周熔断",-1),b=(0,a._)("p",null,"大熔断：10~30 例阳性，触发航班入境第四周起的 4 周熔断（若连续两周 10 例或以上阳性，立刻触发 4 周熔断）",-1),w=(0,a._)("p",null,"超级熔断：30 例以上阳性，立即触发 4 周熔断",-1),k=(0,a._)("p",null,"(稳)：（实验性）若触发连续熔断，熔断恢复后的头两班是一定能正常执飞的。",-1),y=(0,a._)("strong",null,"实验性！",-1),S=(0,a._)("p",null,"输入到目前为止已知的熔断信息和自己估计的熔断概率后，计算未来每周航班正常执飞的概率。",-1),_=(0,a._)("p",null,"需要输入的概率值之和为 100 %。计算时页面会卡顿，但通常可在 5 秒内计算完毕（周数为 20 周时）。",-1),v=(0,a._)("p",null,"结果为航班不受熔断影响正常执飞的概率，显示在每个航班所在行的最后，颜色越深，正常执飞的概率越高，即日期越安全。",-1),W=(0,a._)("p",null,"计算原理：在不影响已设定值的前提下，遍历所有可能的熔断/正常组合并记录每种组合对应的概率，最后对每个航次正常执飞的概率求和。",-1),C=(0,a._)("br",null,null,-1),D=(0,a._)("p",null,"已确定周数：算法假设从第一周至 X 周的阳性病例数是确定且已知的，运行中不会变更这些周的结果。",-1),O=(0,a._)("br",null,null,-1),P=(0,a.Uk)("计算");function j(e,t,n,o,r,j){const U=(0,a.up)("a-button"),x=(0,a.up)("github-outlined"),Z=(0,a.up)("a-date-picker"),A=(0,a.up)("a-input-number"),I=(0,a.up)("a-collapse-panel"),M=(0,a.up)("a-switch"),E=(0,a.up)("a-alert"),H=(0,a.up)("a-form-item"),q=(0,a.up)("a-form"),z=(0,a.up)("a-collapse"),N=(0,a.up)("a-col"),F=(0,a.up)("a-row"),B=(0,a.up)("date-item");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(F,{justify:"space-around"},{default:(0,a.w5)((()=>[(0,a.Wm)(N,{lg:12,md:24},{default:(0,a.w5)((()=>[u,i,(0,a.Wm)(U,{href:"http://www.caac.gov.cn/XXGK/XXGK/TZTG/202104/t20210429_207386.html",target:"_blank"},{default:(0,a.w5)((()=>[s])),_:1}),(0,a.Wm)(U,{href:"https://github.com/jerrylususu/rongduan_or_not",target:"_blank",type:"primary"},{default:(0,a.w5)((()=>[(0,a.Wm)(x)])),_:1}),d,c,(0,a.Wm)(Z,{value:r.beginDate,"onUpdate:value":t[0]||(t[0]=e=>r.beginDate=e),onChange:j.inputHandler},null,8,["value","onChange"]),h,m,(0,a.Wm)(A,{value:r.numberOfWeeks,"onUpdate:value":t[1]||(t[1]=e=>r.numberOfWeeks=e),min:1,max:40,onChange:j.inputHandler},null,8,["value","onChange"]),g,(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[(0,a.Wm)(I,{key:"states",header:"状态说明"},{default:(0,a.w5)((()=>[p,f,b,w,k])),_:1}),(0,a.Wm)(I,{key:"simulation",header:"（实验性）日期安全性计算"},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{checked:r.enableSimulation,"onUpdate:checked":t[2]||(t[2]=e=>r.enableSimulation=e),"checked-children":"开启","un-checked-children":"关闭"},null,8,["checked"]),y,S,_,v,W,C,D,O,(0,a.wy)((0,a.Wm)(E,{message:"未开启本功能，请拨动左上角的开关",type:"warning","show-icon":""},null,512),[[l.F8,!r.enableSimulation]]),(0,a.wy)((0,a.Wm)(E,{message:"概率和不为 100%",type:"error","show-icon":""},null,512),[[l.F8,!j.probSumValid]]),(0,a.wy)((0,a.Wm)(E,{message:"未填写首个航班入境日期",type:"error","show-icon":""},null,512),[[l.F8,!j.initialized]]),(0,a.Wm)(q,{layout:"inline"},{default:(0,a.w5)((()=>[(0,a.Wm)(H,{label:"正常"},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{value:r.probOk,"onUpdate:value":t[3]||(t[3]=e=>r.probOk=e),"addon-after":"%",min:"0",max:"100"},null,8,["value"])])),_:1}),(0,a.Wm)(H,{label:"小熔断"},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{value:r.probMinor,"onUpdate:value":t[4]||(t[4]=e=>r.probMinor=e),"addon-after":"%",min:"0",max:"100"},null,8,["value"])])),_:1}),(0,a.Wm)(H,{label:"大熔断"},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{value:r.probMajor,"onUpdate:value":t[5]||(t[5]=e=>r.probMajor=e),"addon-after":"%",min:"0",max:"100"},null,8,["value"])])),_:1}),(0,a.Wm)(H,{label:"超级熔断"},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{value:r.probImmediate,"onUpdate:value":t[6]||(t[6]=e=>r.probImmediate=e),"addon-after":"%",min:"0",max:"100"},null,8,["value"])])),_:1}),(0,a.Wm)(H,{label:"已确定周数（包含）"},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{value:r.knownWeekCount,"onUpdate:value":t[7]||(t[7]=e=>r.knownWeekCount=e),"addon-before":"至第","addon-after":"周",min:"0",max:r.numberOfWeeks},null,8,["value","max"])])),_:1})])),_:1}),(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a.Wm)(U,{type:"primary",onClick:j.runSimulation,disabled:!j.simulationEnabled},{default:(0,a.w5)((()=>[P])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.Wm)(F,{justify:"space-around"},{default:(0,a.w5)((()=>[(0,a.Wm)(N,{lg:12,md:24},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.datesDetails,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:e.date},[(0,a.Wm)(B,{date:e.date,count:e.count,index:t,triggerStatus:e.triggerStatus,flightStatus:e.flightStatus,enabled:e.enabled,surely:e.surely,showProb:e.showProb&&j.simulationEnabled,yesProb:e.yesProb,onItemChange:j.itemChangeHandler},null,8,["date","count","index","triggerStatus","flightStatus","enabled","surely","showProb","yesProb","onItemChange"])])))),128))])),_:1})])),_:1})])}n(7636);var U=n(3457),x=(n(2758),n(575)),Z=(n(961),n(5924)),A=(n(2008),n(579)),I=(n(6497),n(7228)),M=(n(8510),n(40)),E=(n(5703),n(6643)),H=(n(3332),n(3969)),q=(n(367),n(34)),z=(n(4535),n(6792)),N=n(2134),F=n(7139);const B={key:0},T={key:1};function G(e,t,n,l,o,r){const u=(0,a.up)("a-switch"),i=(0,a.up)("a-input-number"),s=(0,a.up)("a-button"),d=(0,a.up)("check-outlined"),c=(0,a.up)("stop-outlined"),h=(0,a.up)("a-card");return(0,a.wg)(),(0,a.j4)(h,{class:(0,F.C_)([n.flightStatus])},{default:(0,a.w5)((()=>[(0,a.Uk)(" 第 "+(0,F.zw)(n.index+1)+" 周: "+(0,F.zw)(n.date)+" ",1),(0,a.Wm)(u,{checked:o.localEnabled,"onUpdate:checked":t[0]||(t[0]=e=>o.localEnabled=e),size:"small",onChange:r.enabledChangeHandler},null,8,["checked","onChange"]),(0,a.Wm)(i,{value:o.localCount,"onUpdate:value":t[1]||(t[1]=e=>o.localCount=e),onChange:r.countChangeHandler,min:0,disabled:!o.localEnabled},null,8,["value","onChange","disabled"]),(0,a.Wm)(s,{class:(0,F.C_)(n.triggerStatus)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,F.zw)(r.surelyStr+r.triggerStatusName),1)])),_:1},8,["class"]),"yes"===n.flightStatus?((0,a.wg)(),(0,a.iD)("span",B,[(0,a.Wm)(d)])):((0,a.wg)(),(0,a.iD)("span",T,[(0,a.Wm)(c)])),n.showProb?((0,a.wg)(),(0,a.j4)(s,{key:2,type:"dashed",style:(0,F.j5)(r.probColor)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,F.zw)((100*n.yesProb).toFixed(2)+"%"),1)])),_:1},8,["style"])):(0,a.kq)("",!0)])),_:1},8,["class"])}n(7358);var K=n(3023),L=n(6845),X=n(3320);const V={ok:0,minor:5,major:10,immediate:30};function $(e){return R(Y(e))}function Y(e){console.log("recalculating...");for(let t=0;t<e.length;t++){let n=e[t];n.triggerStatus="ok",n.flightStatus="yes",n.surely=!1,n.enabled||(n.triggerStatus="cancelled",n.flightStatus="no")}for(let t=0;t<e.length;t++){let n=e[t],l=0,a=0,o=!1;if("yes"===n.flightStatus)if(0<=n.count&&n.count<5)n.triggerStatus="ok";else if(5<=n.count&&n.count<10)n.triggerStatus="minor",l=2,a=3;else if(10<=n.count&&n.count<30){if(n.triggerStatus="major",l=4,a=3,t-1>=0){let n=e[t-1];n.count>=10&&(l=8,a=1,o=!0)}}else n.triggerStatus="immediate",l=4,a=1;let r=0;while(l>0&&t+a+r<e.length){let u=e[t+a+r];u.enabled&&("yes"===u.flightStatus||o)&&(u.flightStatus="no",u.triggerStatus=`broken by ${n.date}`,l--,0===l&&(o=!1)),r++}}return e}function R(e){let t=0,n=!1;while(t<e.length){if("no"===e[t].flightStatus&&t-1>=0&&["major","minor","immediate"].includes(e[t-1].triggerStatus)){console.log(t);while("no"===e[t].flightStatus)t++;let l=2;while(l>0&&t<e.length)"yes"===e[t].flightStatus&&(l--,e[t].surely=!0,n=!0),t++}n&&(n=!1,t--),t++}return e}function J(e,t){let n=[];for(let l=1;l<=e;l++){let e=new Date(t);e.setDate(e.getDate()+7*(l-1));let a=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0];n.push({date:a,count:0,triggerStatus:"ok",flightStatus:"yes",enabled:!0,surely:!1})}return n}function Q(e,t,n){for(let[l,a]of t.entries())e[l].count=a;for(let[l,a]of n.entries())e[l].enabled=a}function ee(e,t,n){let l=[];for(let o=0;o<t;o++)l.push(0);for(let o=0;o<n;o++)l[o]=e[o].count;let a=e.map((e=>e.enabled));return[l,a]}function te(e,t,n){let[l,a]=t,o=0;for(let i=0;i<l.length;i++){let[t,n]=l[i];o=n,"nop"!==t&&(e[n].count=V[t])}Y(e);let r=o+1;while(r<e.length&&("ok"!==e[r].triggerStatus||!e[r].enabled))r++;if(r===e.length)return null;let u=[];for(const[i,s]of Object.entries(n))if(0!==s){let e=[...l];e.push([i,r]);let t=a*s;u.push([e,t])}return u}function ne(e,t,n,l){let a={};for(let o of e)a[o.date]={yes_prob:0,yes:0,no:0};for(let o of t){Q(e,n,l);let[t,r]=o;for(let n=0;n<t.length;n++){let[l,a]=t[n];"nop"!==l&&(e[a].count=V[l])}Y(e);for(let n of e)a[n.date][n.flightStatus]=1+(a[n.date][n.flightStatus]??0),"yes"===n.flightStatus&&(a[n.date]["yes_prob"]=r+(a[n.date]["yes_prob"]??0))}return a}function le(e){let{datesDetails:t,beginDate:n,numOfWeeks:l,knownWeekCount:a,probMap:o}=e;console.log("datesDetails",t);let r=J(l,n),[u,i]=ee(t,l,a),s=[[[["nop",a-1]],1]],d=[];while(s.length>0){Q(r,u,i);let e=s.shift(),t=te(r,e,o);null===t?d.push(e):s=s.concat(t)}console.log("sim done"),console.log(`prob sum: ${d.map((e=>e[1])).reduce(((e,t)=>e+t),0)}`);let c=ne(r,d,u,i);return c}const ae=function(e,t,n){const l=e>>16,a=e>>8&255,o=255&e,r=t>>16,u=t>>8&255,i=255&t,s=l+n*(r-l),d=a+n*(u-a),c=o+n*(i-o);return"#"+((1<<24)+(s<<16)+(d<<8)+c|0).toString(16).slice(1)};var oe={components:{AButton:z.Z,AInputNumber:E.Z,ACard:K.ZP,CheckOutlined:L.Z,StopOutlined:X.Z,ASwitch:U.ZP},props:{date:{type:String,required:!0},count:{type:Number,required:!1,default:0},index:{type:Number,required:!0},triggerStatus:{type:String,required:!0},flightStatus:{type:String,required:!0},enabled:{type:Boolean,required:!0},surely:{type:Boolean,required:!0},showProb:{type:Boolean,required:!1,default:!1},yesProb:{type:Number,required:!1,default:0}},emits:["itemChange"],data(){return{localCount:this.count,triggerStatusMap:{ok:"正常",minor:"小熔断",major:"大熔断",immediate:"超级熔断",cancelled:"取消"},localEnabled:this.enabled}},methods:{countChangeHandler(e){this.localCount=e,this.$emit("itemChange",{date:this.date,count:this.localCount,enabled:this.localEnabled,index:this.index})},enabledChangeHandler(e){this.localEnabled=e,this.localEnabled||(this.localCount=0),this.$emit("itemChange",{date:this.date,count:this.localCount,enabled:this.localEnabled,index:this.index})}},computed:{triggerStatusName(){return this.triggerStatus in this.triggerStatusMap?this.triggerStatusMap[this.triggerStatus]:this.triggerStatus.replace("broken by","熔断，触发于")},surelyStr(){return this.surely?"(稳)":""},probColor(){let e=this.yesProb>.6?"white":"black";return{"background-color":ae(14938877,870305,this.yesProb),color:e}}},watch:{count:{handler(e){this.localCount=e},immediate:!0},enabled:{handler(e){this.localEnabled=e},immediate:!0}}},re=n(89);const ue=(0,re.Z)(oe,[["render",G],["__scopeId","data-v-30f871bf"]]);var ie=ue,se=n(4870),de={components:{AButton:z.Z,ADatePicker:q.ZP,ASpace:H.Z,AInputNumber:E.Z,DateItem:ie,ARow:M.Z,ACol:I.Z,GithubOutlined:N.Z,ACollapse:A.ZP,ACollapsePanel:A.ZP.Panel,AForm:Z.ZP,AFormItem:Z.ZP.Item,AAlert:x.Z,ASwitch:U.ZP},data(){return{beginDate:"",numberOfWeeks:20,datesDetails:[],knownWeekCount:0,probOk:50,probMinor:40,probMajor:8,probImmediate:2,enableSimulation:!1}},computed:{probSumValid(){return this.probOk+this.probMinor+this.probMajor+this.probImmediate===100},initialized(){return this.datesDetails.length>0},simulationEnabled(){return this.initialized&&this.probSumValid&&this.enableSimulation}},methods:{inputHandler(e){if(!e)return;let t=J(this.numberOfWeeks,this.beginDate);for(let n=0;n<t.length;n++){let e=this.datesDetails.filter((e=>e.date===t[n].date));1==e.length&&(t[n].count=e[0].count,t[n].enabled=e[0].enabled),this.datesDetails.push(t[n])}this.datesDetails=t,this.reCalculate()},itemChangeHandler(e){this.datesDetails[e.index].count=e.count,this.datesDetails[e.index].enabled=e.enabled,this.reCalculate()},reCalculate(){this.datesDetails=$(this.datesDetails)},runSimulation(){let e=le({datesDetails:(0,se.IU)(this.datesDetails),beginDate:(0,se.IU)(this.beginDate),numOfWeeks:this.numberOfWeeks,knownWeekCount:this.knownWeekCount,probMap:{ok:this.probOk/100,minor:this.probMinor/100,major:this.probMajor/100,immediate:this.probImmediate/100}});console.log("sim done");for(let t=this.knownWeekCount+1;t<this.datesDetails.length;t++){let n=this.datesDetails[t];n.yesProb=e[n.date]["yes_prob"],n.showProb=!0}console.log(e)}}};const ce=(0,re.Z)(de,[["render",j]]);var he=ce,me={name:"App",components:{FlightView:he},created(){document.title="今天航班熔断了吗？"},mounted(){let e=document.createElement("script");e.setAttribute("src","https://www.googletagmanager.com/gtag/js?id=G-WKB857318N"),document.head.appendChild(e)}};const ge=(0,re.Z)(me,[["render",r]]);var pe=ge;n(2467);(0,l.ri)(pe).mount("#app")}},t={};function n(l){var a=t[l];if(void 0!==a)return a.exports;var o=t[l]={exports:{}};return e[l].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,l,a,o){if(!l){var r=1/0;for(d=0;d<e.length;d++){l=e[d][0],a=e[d][1],o=e[d][2];for(var u=!0,i=0;i<l.length;i++)(!1&o||r>=o)&&Object.keys(n.O).every((function(e){return n.O[e](l[i])}))?l.splice(i--,1):(u=!1,o<r&&(r=o));if(u){e.splice(d--,1);var s=a();void 0!==s&&(t=s)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[l,a,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var l in t)n.o(t,l)&&!n.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,l){var a,o,r=l[0],u=l[1],i=l[2],s=0;if(r.some((function(t){return 0!==e[t]}))){for(a in u)n.o(u,a)&&(n.m[a]=u[a]);if(i)var d=i(n)}for(t&&t(l);s<r.length;s++)o=r[s],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(d)},l=self["webpackChunkrongduanlema"]=self["webpackChunkrongduanlema"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=n.O(void 0,[998],(function(){return n(1096)}));l=n.O(l)})();
//# sourceMappingURL=app.9f8602b4.js.map