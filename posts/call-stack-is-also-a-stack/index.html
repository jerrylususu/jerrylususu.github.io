<!DOCTYPE html>
<html lang="zh">
	<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="generator" content="Hugo 0.145.0">
	<title>调用栈也是栈 - Nekonull&#39;s Garden</title>

	<meta name="description" content="直接上 eval 就好了">


	
	
	




<link rel="stylesheet" href="/css/ui.css">

	
	

	<script defer src="/js/dark-mode.js"></script>
	<link disabled id="dark-mode-theme" rel="stylesheet" href="/css/dark.css">
	<link  rel="stylesheet" href="/css/dropdown.css">

	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3973436778637330"
	crossorigin="anonymous"></script>

	<link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway">
	
				
	
</head>

<body>
<header class="container no-print">
	<div class="u-header">
		<nav class="bar">
	<ul><li>
			<a href="/">
				<img class="icon-text" src="/img/prev.svg"/>
			</a>
		</li><li><img class="icon-text" id="dark-mode-toggle" src="/img/moon-regular.svg" alt="Toggle Dark Mode"></a></li><li><a href="/til">TIL</a></li><li><a href="/about">关于</a></li><li><a href="/archive">存档</a></li><li><a href="/tags">标签</a></li><li><a href="/share">短文</a></li><li><a href="/posts">长文</a></li><li><a href="/project">项目</a></li>
<li id="language-switch" class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img class="icon-text" src="/img/translate.svg" alt="Select Language"/></a>
<ul class="dropdown-menu">
  
  
  
      
      
          
      
          
            
            
                <li><a href="https://nekonull.me/posts/call-stack-is-also-a-stack/" class="active langselect">简体中文</a></li>
            
          
      
  
</ul>






	</ul>
</nav>

	</div>
</header>
<main class="container">

<article>
	<header><hgroup id="brand">
	<h1>调用栈也是栈</h1>
	<h5>
		
		<time datetime="2021-08-22 22:02:00 &#43;0300 &#43;0300">2021/08/22</time>
		<span class="no-print">
			-
				
				<a href="/tags/%e9%a2%98">题</a>
				
				<a href="/tags/hack">hack</a>
				<span>
	</h5>
	
</hgroup>
<hr class="sep" />
</header>
	<p>又到了秋招的季节，刷题的时候遇到了一道有趣的题，简化如下：</p>
<ul>
<li>
<p>定义一类字符串为 NB 串，每个 NB 串有一个对应的 NB 值</p>
</li>
<li>
<p>空串是一个 NB 串，且其 NB 值为 1</p>
</li>
<li>
<p>对一个 NB 串，在其两侧加上括号后依然是一个合法的 NB 串，且其 NB 值为原串 NB 值加 1</p>
</li>
<li>
<p>对两个 NB 串，将其拼接后依然是一个合法的 NB 串，且其 NB 值为两个原串 NB 值的乘积</p>
</li>
<li>
<p>问：给定一个已知合法的 NB 串，求其 NB 值</p>
</li>
<li>
<p>样例</p>
<pre tabindex="0"><code>(())() -&gt; 3*2 = 6
(()())() -&gt; 5*2 = 10
()()()(()) -&gt; 2*2*2*3 = 24
</code></pre></li>
</ul>
<p>看到括号，第一反应当然是用栈。先想了一会有没有只扫描一遍字符串的做法，但是很可惜没想出来。最后想了一个先构造树，再在树上遍历的做法，解答如下。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.LinkedList;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Stack;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NBString</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        String s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;(()())()&#34;</span>;
</span></span><span style="display:flex;"><span>        NBNode root <span style="color:#f92672">=</span> buildTree(s);
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(getNode(root) <span style="color:#f92672">-</span> 1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> NBNode <span style="color:#a6e22e">buildTree</span>(String s){
</span></span><span style="display:flex;"><span>        NBNode root <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> NBNode(<span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">char</span><span style="color:#f92672">[]</span> chars <span style="color:#f92672">=</span> s.<span style="color:#a6e22e">toCharArray</span>();
</span></span><span style="display:flex;"><span>        Stack<span style="color:#f92672">&lt;</span>NBNode<span style="color:#f92672">&gt;</span> stack <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Stack<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> chars.<span style="color:#a6e22e">length</span>; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">char</span> c <span style="color:#f92672">=</span> chars<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(c<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;(&#39;</span>){
</span></span><span style="display:flex;"><span>                NBNode father;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(stack.<span style="color:#a6e22e">isEmpty</span>()){
</span></span><span style="display:flex;"><span>                    father <span style="color:#f92672">=</span> root;
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    father <span style="color:#f92672">=</span> stack.<span style="color:#a6e22e">peek</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                NBNode newNode <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> NBNode(father);
</span></span><span style="display:flex;"><span>                father.<span style="color:#a6e22e">child</span>.<span style="color:#a6e22e">add</span>(newNode);
</span></span><span style="display:flex;"><span>                stack.<span style="color:#a6e22e">push</span>(newNode);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (c<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;)&#39;</span>){
</span></span><span style="display:flex;"><span>                stack.<span style="color:#a6e22e">pop</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> root;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getNode</span>(NBNode node){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(node<span style="color:#f92672">==</span><span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span> 1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> layerProd <span style="color:#f92672">=</span> 1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (NBNode NBNode : node.<span style="color:#a6e22e">child</span>) {
</span></span><span style="display:flex;"><span>            layerProd <span style="color:#f92672">*=</span> getNode(NBNode);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> layerProd <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NBNode</span> {
</span></span><span style="display:flex;"><span>    NBNode head;
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>NBNode<span style="color:#f92672">&gt;</span> child;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">NBNode</span>(NBNode _head){
</span></span><span style="display:flex;"><span>        head <span style="color:#f92672">=</span> _head;
</span></span><span style="display:flex;"><span>        child <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>但是如果换个角度来看，其实题目描述的 NB 串，可以被视为是一个简单的类型定义，语法大致如下。然后要做的，就是把输入数据视作代码，构造抽象语法树，然后在语法树上操作得到结果了。</p>
<pre tabindex="0"><code>NBString = &#34;&#34; | &#34;(&#34; NBString &#34;)&#34; | NBString NBString
</code></pre><p>如果 OJ 提供了类似于 Haskell 之类内置支持模式匹配的语言，那么就很简单了：把输入 tokenize，写一个 <code>calc</code> 函数，然后直接按照题目要求写匹配规则和返回值就好了。伪代码如下。</p>
<pre tabindex="0"><code>calc :: NBString -&gt; Int
calc = match str
	case &#34;&#34;: return 1
	case &#34;(&#34; sub &#34;)&#34;: return 1 + calc sub
	case sub1 sub2: return calc sub1 * calc sub 2
</code></pre><p>然而现实并没有这么美好。但是难道就应该就此放弃吗？未必。实际上编程语言内的调用栈，也是一个栈，或者说语言本身就提供了我们所期望的解析语法树的功能。高人指点之下，可以用以下的 hack 来实现：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(x<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;(()())()&#34;</span>
</span></span><span style="display:flex;"><span>s <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;(&#34;</span>,<span style="color:#e6db74">&#34;f(&#34;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;)f(&#34;</span>,<span style="color:#e6db74">&#34;)*f(&#34;</span>)
</span></span><span style="display:flex;"><span>print(eval(s))
</span></span></code></pre></div><p>上文代码所做的，实际上就是把输入串，替换成了一系列函数调用，并添加了符合题目要求的函数体。最后只需要直接调用 Python 内置的 <code>eval</code>，就可以得到正确的答案了。</p>

</article>
<nav class="no-print post-nav">

	<a class="prev-post" href="https://nekonull.me/posts/tf-cert-blog/">
		<img class="icon-text" src="/img/prev.svg"/>Tensorflow 开发者认证记录</a>


	<a class="next-post" href="https://nekonull.me/posts/distributed-system-course-notes/">分布式系统课程笔记<img class="icon-text" src="/img/next.svg"/>
	</a>

</nav>





	
  <script
    src="https://giscus.app/client.js"
    data-repo="jerrylususu/jerrylususu.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkxNDM1MTk3NDY="
    data-category="Blog Comments"
    data-category-id="DIC_kwDOCI3wAs4CZNcG"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-input-position="top"
    data-theme="preferred-color-scheme"
    data-lang="zh-CN"
    data-loading="lazy"
    data-strict="1"
    
    data-theme="preferred-color-scheme"
    crossorigin="anonymous"
    async
  ></script>

			<hr class="sep" />
		</main>
		<footer class="container no-print">
			<div class="u-footer">
				

<a href="https://github.com/jerrylususu/"><img class="icon-social" src="/img/github.svg" alt="Github"/></a>







				<p>
					
					使用的主题: <a href="https://github.com/yursan9/manis-hugo-theme">Manis</a><br>
					
					
					CC-BY-SA-4.0
					
					
				</p>
				
				<a href="#brand">
					<img class="icon-text" src="/img/toup.svg" alt="To Up"/>
					<span>回到顶部</span>
				</a>
				
			</div>
		</footer>
		
	</body>
</html>

