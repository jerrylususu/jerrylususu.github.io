---
title: Python `itertools.permutations` ä½¿ç”¨çš„æ’åˆ—ç®—æ³•
date: 2022-05-10T22:54:00+08:00
description: ä¼¼ä¹ä¹‹å‰æ²¡äººå†™è¿‡ï¼Ÿé‚£å°±æˆ‘æ¥å§ã€‚
tags:
  - ç®—æ³•
---

**TL;DR**ï¼šè¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºå›æº¯ï¼Œåˆ©ç”¨å…ƒç´ äº¤æ¢çš„é€’å½’æ’åˆ—ç”Ÿæˆç®—æ³•ï¼Œä½†è¢«é‡å†™æˆäº†å¾ªç¯å½¢å¼ï¼ˆå¯èƒ½å‡ºäºæ•ˆç‡è€ƒé‡ï¼‰ã€‚

## å¼•å­

æœ€è¿‘åœ¨ç®—æ³•å¤å¥ï¼Œåˆ·åˆ°äº†æ’åˆ—ç›¸å…³çš„é¢˜ç›®ã€‚æ°å·§ Python å†…ç½®äº†ä¸€ä¸ªéå¸¸å®ç”¨çš„å·¥å…·åº“ `itertools`ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª `permutations(iterable, r)` æ–¹æ³•ï¼Œå¯ä»¥å¯¹ä¸€ä¸ªç»™å®šçš„ iterable ç”Ÿæˆæ‰€æœ‰å¤§å°ä¸º `r` çš„æ’åˆ—ï¼Œä¸”è¾“å‡ºæŒ‰ç…§å­—å…¸åºæ’åˆ—ã€‚

> ```Python
> >>> list(permutations('ABCD', 2))
> [('A', 'B'), ('A', 'C'), ('A', 'D'), 
>  ('B', 'A'), ('B', 'C'), ('B', 'D'), 
>  ('C', 'A'), ('C', 'B'), ('C', 'D'), 
>  ('D', 'A'), ('D', 'B'), ('D', 'C')]
> ```

åœ¨æˆ‘ä¹‹å‰æ‰€æ¥è§¦çš„ç®—æ³•ä¸­ï¼Œæ’åˆ—ç”Ÿæˆè¦ä¹ˆæ˜¯åŸºäºå›æº¯ï¼Œè¦ä¹ˆæ˜¯åŸºäºå­—å…¸åºï¼Œä½†æ— è®ºå“ªç§éƒ½åªèƒ½ç”Ÿæˆå…¨æ’åˆ—ï¼Œè€Œæ— æ³•ç”Ÿæˆè¿™æ ·çš„éƒ¨åˆ†æ’åˆ—ï¼ˆæŒ‡ç”Ÿæˆçš„æ’åˆ—é•¿åº¦ `r` å’ŒåŸè¾“å…¥é•¿åº¦ `n` ä¸åŒï¼‰ã€‚å¦ä¸€æ¡æ€è·¯æ˜¯å…ˆç”Ÿæˆæ‰€æœ‰é•¿åº¦ä¸º `r` çš„ç»„åˆï¼Œç„¶åå†åœ¨æ¯ä¸ªç»„åˆå†…ç”Ÿæˆå…¨æ’åˆ—ï¼Œä½†è¿™æ ·æ— æ³•ä¿è¯è¾“å‡ºæŒ‰å­—å…¸åºï¼ˆé™¤éå…ˆæ‰‹åŠ¨æ”¶é›†å†æ’åºï¼‰ã€‚

äºæ˜¯æˆ‘æ‰“å¼€äº† Python çš„ `itertools` çš„å®˜æ–¹æ–‡æ¡£ï¼Œå…¶ä¸­æä¾›äº†ä¸ CPython å®ç°ç­‰ä»·çš„ Python ä»£ç ï¼Œ`permutations` æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼ˆ[ğŸ”—](https://docs.python.org/zh-cn/3/library/itertools.html#itertools.permutations)ï¼‰ï¼š

```python
def permutations(iterable, r=None):
    # permutations('ABCD', 2) --> AB AC AD BA BC BD CA CB CD DA DB DC
    # permutations(range(3)) --> 012 021 102 120 201 210
    pool = tuple(iterable)
    n = len(pool)
    r = n if r is None else r
    if r > n:
        return
    indices = list(range(n))
    cycles = list(range(n, n-r, -1))
    yield tuple(pool[i] for i in indices[:r])
    while n:
        for i in reversed(range(r)):
            cycles[i] -= 1
            if cycles[i] == 0:
                indices[i:] = indices[i+1:] + indices[i:i+1]
                cycles[i] = n - i
            else:
                j = cycles[i]
                indices[i], indices[-j] = indices[-j], indices[i]
                yield tuple(pool[i] for i in indices[:r])
                break
        else:
            return
```

### å°è¯•åˆæ­¥ç†è§£

è™½ç„¶é¡¶éƒ¨æœ‰ä¸¤è¡Œæ³¨é‡Šï¼Œä¸è¿‡è¿™ä¹Ÿåªæ˜¯æè¿°äº†è¿™ä¸ªæ–¹æ³•çš„æ•ˆæœï¼Œå¯¹å…¶åŸç†å¹¶æ²¡æœ‰ä»»ä½•è§£é‡Šã€‚å¾€åç»§ç»­çœ‹ï¼Œå¯ä»¥å‘ç°ç®—æ³•é¦–å…ˆæ„é€ äº†ä¸¤ä¸ª listï¼š`indices` å’Œ `cycles`ï¼Œä¸”ä¹‹åæ¯æ¬¡è¾“å‡ºç»“æœï¼ˆ`yield`ï¼‰å®é™…ä¸Šéƒ½æ˜¯å°† `indices` ä¸­çš„å‰ `r` ä¸ªè¾“å‡ºã€‚å†å¾€åç®—æ³•è¿›å…¥äº†ä¸€ä¸ªç¥ç§˜çš„ `for` å¾ªç¯ï¼Œå¯¹ `cycles` ä¸­çš„å…ƒç´ åšäº†ä¸€äº›ä¿®æ”¹ï¼Œç”¨ `cycles` çš„å€¼å¯¹ `indices` ä¸­çš„ä¸€äº›å…ƒç´ åšäº†äº¤æ¢ã€‚ä»…ä»ä»£ç å±‚é¢å‡ºå‘ï¼Œå¯¹ç®—æ³•çš„ç†è§£ä¼¼ä¹ä¹Ÿå°±æ­¢æ­¥äºæ­¤äº†ã€‚ç„¶è€Œè¿™å¹¶æ²¡æœ‰å›ç­”ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¿™ä¸ªç®—æ³•èƒ½å·¥ä½œï¼Ÿ

### å¯»æ‰¾ç›¸å…³ä¿¡æ¯

è€ƒè™‘åˆ° `itertools` åº“æ˜¯åœ¨ Python 2.3 ï¼ˆ2003 å¹´ 7 æœˆï¼‰è¢«å¼•å…¥æ ‡å‡†åº“çš„ï¼Œè¿™ä¸ªç®—æ³•å·²ç»ç®—å¾—ä¸Šå†å²æ‚ ä¹…äº†ã€‚å†åŠ ä¹‹ `itertools` åº“çš„å¹¿æ³›ä½¿ç”¨ï¼Œè¿™ä¸ªç®—æ³•çš„åŸç†åº”è¯¥æ˜¯æ—©å·²è¢«è¯¦å°½è®°å½•çš„ã€‚å¸¦ç€è¿™æ ·çš„æœŸæœ›ï¼Œæˆ‘å¼€å§‹ç”¨å„ç§å…³é”®è¯ç»„åˆæœç´¢ç›¸å…³ä¿¡æ¯ã€‚å¯æƒœçš„æ˜¯ï¼Œé™¤äº† Stack Overflow ä¸Šä¸€ä¸ª 2010 å¹´çš„é—®é¢˜ï¼ˆ[ğŸ”—](https://stackoverflow.com/questions/2565619/algorithm-for-python-itertools-permutations)ï¼‰ï¼Œå’Œä¸€ä¸ªçŸ¥ä¹æé—®ï¼ˆ[ğŸ”—](https://www.zhihu.com/question/440688033)ï¼‰ï¼Œå°±æ²¡æœ‰ä»»ä½•å…¶ä»–ç›¸å…³çš„ç½‘é¡µäº†ï¼Œç”šè‡³è¿å½“å¹´çš„æäº¤è®°å½•éƒ½æ‰¾ä¸åˆ°ã€‚

æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£å°±åªèƒ½ä»è¿™ä¸¤ä¸ªé“¾æ¥å…¥æ‰‹äº†ã€‚

- Stack Overflow çš„ç­”ä¸» Alex å†™äº†ä¸€ç¯‡é•¿æ–‡å›ç­”ï¼Œä½†ä¸€å¼€å¤´å°±è¯´ã€Œä½ éœ€è¦ç†è§£ Permutation Cycle çš„æ•°å­¦ç†è®ºï¼Œæ‰èƒ½ç†è§£è¿™ä¸ªç®—æ³•ã€ã€‚äºæ˜¯æˆ‘åˆå›å¤´æ¶è¡¥äº†ä¸€ç•ªç»„åˆæ•°å­¦ï¼Œç„¶è€Œå°±ç®—æˆ‘å¤§æ¦‚çŸ¥é“ Permutation Cycle æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œå¯¹è¿™ä¸ªç®—æ³•ä¾ç„¶æ¯«æ— å¤´ç»ªã€‚ï¼ˆè¯„è®ºä¸­ä¹Ÿæœ‰äººè‡ªç§°æœ‰ 6 å¹´æŠ½è±¡ä»£æ•°ç»éªŒï¼Œä½†ä¸è®¤ä¸ºè¿™ä¸ªç®—æ³•ä¸æ•°å­¦ç›¸å…³ã€‚ï¼‰ä¸è¿‡ Alex çš„å›ç­”æä¾›äº†ä¸€äº›æœ‰ç”¨çš„ç›´è§‰ï¼Œè‡³å°‘è¯»å®Œè¿™ä¸ªå›ç­”æˆ‘å¤§æ¦‚ç†è§£ `cycles` åœ¨ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦‚ä½•å˜åŒ–çš„äº†ã€‚å…·ä½“è€Œè¨€ï¼Œ`cycles` çš„å˜åŒ–ç±»ä¼¼äºã€Œå€’è®¡æ—¶ã€ï¼Œæˆ–è€…è¯´ã€Œå¸¦å€Ÿä½çš„å‡æ³•ã€ï¼Œæ¯æ¬¡æœ€åä¸€ä½åˆ° 0 æ—¶ï¼Œå°±ä¼šè§¦å‘å‰é¢çš„ä¸€ä½å‡ 1ã€‚ç„¶è€Œæˆ‘å¯¹`indices` çš„å˜åŒ–ä¾ç„¶äº‘é‡Œé›¾é‡Œã€‚
- çŸ¥ä¹æé—®ä¸­ï¼Œç­”ä¸»ã€Œæ¨ä¸ªæ¯›ã€æä¾›äº†ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆæœ‰è¯´æœåŠ›çš„å›ç­”ï¼ˆå‰§é€ï¼šè€Œä¸”ä¹Ÿçš„ç¡®å¦‚æ­¤ï¼‰ï¼šã€Œé‚£ä¸ªä»£ç å¯ä»¥çœ‹æˆä¸‹åˆ—é€’å½’ç¨‹åºçš„å¼ºè¡Œéé€’å½’ç‰ˆã€ï¼ŒæŒ‡å‡ºäº† `cycles` æ˜¯**å˜è¿›åˆ¶æ•°**ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªåŸå§‹é€’å½’ç‰ˆæœ¬ã€‚å¯æƒœçš„æ˜¯ï¼Œå¯¹äºè¿™ä¸ªç®—æ³•ä¸ºä»€ä¹ˆå¯ä»¥è¾“å‡ºæ­£ç¡®ç»“æœä¾ç„¶æ²¡æœ‰è§£é‡Šï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘æ²¡æœ‰å®Œå…¨ç†è§£ï¼‰ã€‚

### è‡ªå·±æ¥

å·²æœ‰çš„ä¿¡æ¯ä¼¼ä¹ä¸æ˜¯å¾ˆå……åˆ†ã€‚çœ‹æ¥æˆ‘åªèƒ½è‡ªå·±æ¥äº†ã€‚åœ¨åŠ äº†ä¸€å † `print` å¹¶åœ¨çº¸ä¸Šæ‰‹åŠ¨æ¨¡æ‹Ÿäº†å¤šæ¬¡è¿™ä¸ªç®—æ³•ä¹‹åï¼Œæˆ‘è®¤ä¸ºæˆ‘å¯èƒ½å¤§æ¦‚ç†è§£å®ƒçš„å·¥ä½œåŸç†ï¼Œå¹¶ä¸”å¯ä»¥è¯æ˜å…¶æ­£ç¡®æ€§äº†ã€‚ä¸‹æ–‡å°†è¯¦è¿°æˆ‘çš„ç†è§£ã€‚

## ç®—æ³•

### èµ·æ­¥

å¼€å§‹å‰ï¼Œéœ€è¦ç»Ÿä¸€ä¸€ä¸‹åæ–‡ä½¿ç”¨çš„è®°å·ï¼š

- `n` ä»£è¡¨è¾“å…¥ iterable çš„é•¿åº¦
- `r` ä»£è¡¨è¾“å‡ºçš„æ’åˆ—å…ƒç»„çš„é•¿åº¦

å¹¶å›é¡¾æˆ‘ä»¬å…ˆå‰é˜…è¯»ç®—æ³•å¾—åˆ°çš„ç†è§£ï¼š

- å¯¹è¾“å…¥çš„ `iterable` ä¼šéå†å…¶æ‰€æœ‰å…ƒç´ å¹¶æ”¾åœ¨ `pool` ä¸­
- æ¯æ¬¡ç®—æ³•è¾“å‡ºç»“æœï¼ˆ`yield`ï¼‰ï¼Œå®é™…ä¸Šåªæ˜¯å–äº† `indices` åˆ—è¡¨çš„å‰ `r` ä¸ª indexï¼Œå¹¶è¾“å‡º `pool` ä¸­çš„å¯¹åº”å…ƒç´ ã€‚

æˆ‘ä»¬å°†æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤ç†è§£è¿™ä¸ªç®—æ³•ï¼š

1. ç†è§£ `cycles` çš„å˜åŒ–
2. ç†è§£ `indices` çš„å˜åŒ–ï¼Œå¹¶å°è¯•è¯´æ˜è¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§
3. å°è¯•é‡æ–°å®ç°è¿™ä¸ªç®—æ³•çš„ã€ŒåŸå§‹ã€é€’å½’ç‰ˆæœ¬

### `cycles`

æˆ‘ä»¬é¦–å…ˆä» `cycles` å˜é‡å…¥æ‰‹ï¼Œç†è§£å®ƒåœ¨è¿™ä¸ªç®—æ³•ä¸­æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬æš‚æ—¶å…ˆä¸è€ƒè™‘ `indices`ã€‚

å¯ä»¥å…ˆæŒ‡å®šä¸€äº›å…·ä½“çš„è¾“å…¥ï¼Œç„¶åå°è¯•åŠ ä¸€äº› `print` è¯­å¥ã€‚ä»¥ `iterable="ABCD", r=2` ä½œä¸ºè¾“å…¥ï¼Œåœ¨ `if` å’Œ `else` ä¸¤ä¸ªåˆ†æ”¯æ‰§è¡Œå‰åä¸­éƒ½æ’å…¥ `print`ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼šï¼ˆå…¶ä¸­ä¸­æ‹¬å·è¯´æ˜ç®—æ³•æœ‰è¾“å‡º `yield`ï¼Œå¤§æ‹¬å·éƒ¨åˆ†ç®—æ³•æ— è¾“å‡ºï¼‰

```
[4,3] -> [4,2] -> [4,1] -> {4,0} -> {4,3} -> 
[3,3] -> [3,2] -> [3,1] -> {3,0} -> {3,3} -> 
[2,3] -> [2,2] -> [2,1] -> {2,0} -> {2,3} -> 
[1,3] -> [1,2] -> [1,1] -> {1,0} -> {1,3} -> {0,3} -> {4,3}
```

æˆ‘ä»¬å¯ä»¥ç›´è§‚æ„Ÿå—åˆ°ï¼Œä¼¼ä¹ `cycles` å˜é‡å°±åƒä¸€ä¸ªã€Œå€’è®¡æ—¶ã€ï¼Œæˆ–è€…è¯´ã€Œå¸¦å€Ÿä½çš„å‡æ³•ã€ã€‚

- ä¸€å¼€å§‹ `cycles[0]` è¢«åˆå§‹åŒ–ä¸º 4ï¼Œ`cycles[1]` è¢«åˆå§‹åŒ–ä¸º 3ã€‚
- ä¹‹åçš„å¾ªç¯ä¸­ï¼Œä¸€èˆ¬æ˜¯ `cycles[1]` ä¸æ–­è¢«å‡ 1ã€‚å½“ `cycles[1] != 0` æ—¶ï¼Œç®—æ³•ä¼šäº§ç”Ÿä¸€æ¬¡è¾“å‡ºã€‚
- å¦‚æœ `cycles[1] == 0`ï¼Œä¼šå¯¼è‡´ `cycles[0]` ï¼ˆå‰ä¸€ä½ï¼‰å‡ 1ï¼Œå¹¶å°† `cycles[1]` é‡è®¾å›å…¶åˆå§‹å€¼ 3ã€‚
- æœ€åå½“ `cycles[0] == 0` æ—¶ï¼Œç®—æ³•ç»“æŸã€‚

ä»è¿™ä¸ªå…·ä½“çš„ç¤ºä¾‹å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ `cycles` çš„å˜åŒ–ï¼š

- ä¸€å¼€å§‹ `cycles` è¢«åˆå§‹åŒ–ä¸º `range(n, n-r, -1)`ï¼Œå³ `cycles[0]=n`ï¼Œ`cycles[1]=n-1`ï¼Œ...ï¼Œ`cycles[i]=n-i`ã€‚
- ä¹‹åçš„å¾ªç¯ä¸­ï¼Œé€šå¸¸åªæœ‰æœ€åä¸€ä¸ªå…ƒç´  `cycles[r-1]` åœ¨ä¸æ–­é€’å‡ã€‚å¦‚æœ `cycles[r-1]` é€’å‡åå€¼ä¸ä¸º 0ï¼Œåˆ™ç®—æ³•ä¼šäº§ç”Ÿä¸€æ¬¡è¾“å‡ºã€‚ç”¨æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ã€Œå€’è®¡æ—¶ã€ç±»æ¯”ï¼Œå¯ä»¥å°†è¿™ç§æƒ…å†µç§°ä¹‹ä¸º tickã€‚
- å¦‚æœ `cycles` ä¸­çš„æŸä¸ªå…ƒç´ ï¼ˆå¦‚ `cycles[i]`ï¼‰ä¸º 0ï¼Œä¼šå¯¼è‡´å…¶å‰é¢çš„å…ƒç´ è¢«ï¼ˆ`cycles[i-1]`ï¼‰å‡ 1ï¼Œå¹¶å°†è¿™ä¸ªå…ƒç´ ï¼ˆ`cycles[i]`ï¼‰é‡è®¾å›å…¶åˆå§‹å€¼ï¼ˆ`n-i`ï¼‰ã€‚è¿™ä¸€è¡Œä¸ºç±»ä¼¼äºå€’è®¡æ—¶ä¸­ç§’ä¸º 0 æ—¶ä¼šå¯¼è‡´åˆ†å‡ 1ï¼Œå¹¶å°†ç§’é‡è®¾å› 0ã€‚ç»§ç»­ç”¨ã€Œå€’è®¡æ—¶ã€ç±»æ¯”ï¼Œå¯ä»¥å°†è¿™ç§æƒ…å†µç§°ä¹‹ä¸º resetã€‚

æœ‰äº†è¿™ä¸€ç›´è§‚æ„Ÿå—ï¼Œå°±å¯ä»¥ä¸º `cycles` æ‰¾å‡ºä¸€ä¸ªå¯èƒ½çš„è§£é‡Šï¼ˆã€Œç‰©ç†å«ä¹‰ã€ï¼‰äº†ã€‚æˆ‘è®¤ä¸ºï¼Œ`cycles` ä»£è¡¨çš„æ˜¯ **ã€Œæ¯ä¸ªä½ç½®ä¸Šå‰©ä½™çš„å¯ç”¨é€‰æ‹©æ•°ã€** ã€‚å¦‚æœå°† `cycles` è§†ä½œä¸€ä¸ªå˜è¿›åˆ¶æ•°ï¼Œåˆ™ `cycles` ä¹Ÿä»£è¡¨ **ã€Œæ€»ä½“å‰©ä½™è¿˜æ²¡æœ‰è¾“å‡ºçš„æ’åˆ—æ•°ã€** ã€‚ç†ç”±å¦‚ä¸‹ï¼š

- ä¸€å¼€å§‹ `cycles` è¢«åˆå§‹åŒ–ä¸º `range(n, n-r, -1)`ï¼Œè€Œå¯ä»¥è®¡ç®—å‡ºå¯¹ç»™å®šçš„ `n`, `r` æ‰€æœ‰çš„æ’åˆ—æœ‰ `P(n,r) = n*(n-1)*...*(n-r-1)` ç§ã€‚
- æ¯æ¬¡ tickï¼Œç®—æ³•ç”Ÿæˆä¸€ä¸ªæ’åˆ—ï¼Œæ¶ˆè€—ä¸€ä¸ªé€‰æ‹©ï¼Œ`cycles[i]` ä¹Ÿå‡ 1
- æ¯æ¬¡ resetï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ `cycles` è¿™ä¸ªå˜è¿›åˆ¶æ•°ä¸Šçš„å€Ÿä½å‡æ³•
- æœ€ååœ¨ `cycles` ä¸Šé¦–ä½ä¸º 0 æ—¶ç®—æ³•ç»“æŸï¼Œä»£è¡¨æ‰€æœ‰æ’åˆ—çš„é€‰æ‹©éƒ½å·²ç»è¢«æ¶ˆè€—ï¼ˆè¾“å‡ºï¼‰äº†ï¼Œå·²ç»æ²¡æœ‰æ›´å¤šçš„æ’åˆ—äº†ã€‚

å…¶å® `cycles` çš„å˜åŒ–ï¼Œæ— è®ºæ˜¯ Stack Overflow ä¸Šçš„å›ç­”ï¼Œè¿˜æ˜¯çŸ¥ä¹ä¸Šçš„å›ç­”ï¼Œéƒ½æœ‰ç›¸å¯¹è¯¦å°½çš„æè¿°ã€‚åœ¨æ­¤æˆ‘åªæ˜¯å°è¯•ä»¥è‡ªå·±çš„è¯­è¨€é‡è¿°äº†ä¸€æ¬¡è€Œå·²ã€‚ä½†æ¥ä¸‹æ¥å¯¹ `indices` çš„ç†è§£å°±å¤§éƒ¨åˆ†æ˜¯æˆ‘è‡ªå·±çš„äº†ã€‚

### `indices`

ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ `indices` æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚å’Œä¹‹å‰å¯¹ `cycles` çš„æ¢ç´¢ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå…ˆä»ä¸€ä¸ªå…·ä½“çš„ä¾‹å­å¼€å§‹ï¼š`iterable="ABCDE",r=3`ï¼Œå¹¶å…³æ³¨ä¸€ä¸ªå­é—®é¢˜ï¼šå‰ 3 ä¸ªè¾“å‡ºï¼ˆABC, ABD, ABEï¼‰æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚ä¸ºä¾¿äºå±•ç¤ºï¼Œè¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨å…·ä½“å…ƒç´ ï¼ˆå­—æ¯ï¼‰ä»£æ›¿ indexã€‚åŠ äº†ä¸€äº› `print` åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å˜åŒ–è¿‡ç¨‹ã€‚

![py_permutation](/img/py_permutation.png)

è¿™ä¸ªå›¾ç¨å¾®æœ‰äº›å¤æ‚ã€‚ä»¥ä¸‹æ˜¯è¿›ä¸€æ­¥è§£é‡Šã€‚

- å›¾çš„é˜…è¯»é¡ºåºæ˜¯ä»ä¸Šè‡³ä¸‹ï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºå±•ç¤ºäº†`indices` åˆ—è¡¨çš„å˜åŒ–ã€‚å·¦ä¾§ä¸ºå„é˜¶æ®µå…·ä½“è¡Œä¸ºçš„æ ‡æ³¨ï¼Œå³ä¾§ä¸ºç®—æ³•è¾“å‡ºã€‚
- è¿™é‡Œé€‰æ‹©å±•ç¤ºå‰ 3 æ¬¡è¾“å‡ºï¼ˆå³ `i=2`ï¼‰ï¼Œå¯¹åº” `cycles[2]` ä» 3 åˆ° 0 çš„è¿‡ç¨‹ã€‚åˆ«å¿˜äº†æ¯æ¬¡è¿›å…¥å¾ªç¯å‰ `cycles[2]` ä¼šè¢«é€’å‡ã€‚
- ä¸ºæ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ `indices` åˆ—è¡¨æ‹†æˆ 3 ä¸ªéƒ¨åˆ†ï¼š
  - fixedï¼š`indices[0:1]`ï¼Œåœ¨æ‰§è¡Œæ—¶ä¸ä¼šå˜åŒ–
  - changingï¼š`indices[2]`ï¼Œè¿™æ˜¯åœ¨ä¸æ–­è¢«äº¤æ¢çš„å…ƒç´ ï¼Œå’Œ fixed ä¸€èµ·ç»„æˆäº†ç®—æ³•è¾“å‡ºï¼ˆ`indices[0:2]`ï¼‰
  - backlogï¼š`indices[3:4]`ï¼Œè¿™é‡Œå­˜æ”¾ç€å·²ç»è¢«ä½¿ç”¨çš„å…ƒç´ å’Œè¿˜æœªè¢«ä½¿ç”¨çš„å…ƒç´ 
- åœ¨æ¯ä¸ª tick ä¸­ï¼Œchanging ä½ç½®ä¸Šçš„å…ƒç´ å’Œ backlog ä¸­çš„ä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼ˆ`swap`ï¼‰ï¼Œå¹¶è§¦å‘ä¸€æ¬¡è¾“å‡ºã€‚å¯ä»¥æ³¨æ„åˆ°ï¼Œäº¤æ¢å‰å backlog ä¸­å…ƒç´ ä¾ç„¶ç»´æŒå…¶ç›¸å¯¹é¡ºåºã€‚
  - ABC{DE} -> ABD{CE} -> ABE{CD}
  - æ³¨ï¼šè¿™é‡Œå°†ç®—æ³•å¼€å§‹æ—¶çš„é¦–æ¬¡è¾“å‡ºä¹Ÿè§†ä½œä¸€ä¸ª tickï¼Œå› ä¸ºè¿›å…¥å¾ªç¯å‰ä¾ç„¶è§¦å‘äº†é€’å‡ï¼Œæ¶ˆè€—äº†ä¸€ä¸ªå¯èƒ½æ€§ã€‚
  - ç›¸å…³ä»£ç ï¼š`indices[i], indices[-j] = indices[-j], indices[i]`
- ç®—æ³•ç»“æŸå‰ï¼Œä¸€å…±è§¦å‘äº† 3 æ¬¡è¾“å‡ºã€‚è¿™å·²ç»ç©·å°½äº†å›ºå®šå‰ç¼€ä¸º `AB`ï¼Œæœ€åä¸€ä¸ªå¯é€‰é¡¹ä¸º `C`, `D`, `E` çš„æ’åˆ—ã€‚
- åœ¨æœ€å reset æ—¶ï¼Œchanging ä½ç½®ä¸Šçš„å…ƒç´ è¢«ç§»åˆ°äº† backlog åï¼ˆ`move_to_last`ï¼‰ã€‚è¿™ä¸€æ­¥å®Œæˆåï¼Œchanging + backlog è¿™ä¸ªå­åˆ—è¡¨ï¼ˆ`indices[2:4]`ï¼‰æ¢å¤äº†å’Œç®—æ³•å¼€å§‹æ—¶ä¸€æ ·çš„é¡ºåºã€‚
  - AB{E}CD -> ABCD{E}
  - ç›¸å…³ä»£ç ï¼š`indices[i:] = indices[i+1:] + indices[i:i+1]`



å¯ä»¥å‘ç°ï¼Œè¿™éƒ¨åˆ†æ‰§è¡Œè¿‡ç¨‹ï¼Œæ°å¥½æ»¡è¶³äº†å›æº¯ç®—æ³•çš„æ­£ç¡®æ€§è¦æ±‚ï¼š
- åˆ†æ­¥è§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œæ¯æ­¥ä¸­å›ºå®šä¹‹å‰æ­¥éª¤çš„é€‰æ‹©ä¸å˜
- ç®—æ³•æ‰§è¡Œä¸­ï¼Œéå†å½“å‰æ­¥çš„æ‰€æœ‰å¯èƒ½æ€§
- ç®—æ³•æ‰§è¡Œåï¼Œå–æ¶ˆå½“å‰æ­¥çš„è®¡ç®—ï¼Œé€€å›ä¸Šä¸€æ­¥ï¼Œé€‰æ‹©ä¸‹ä¸€ä¸ªå¯é€‰é¡¹

è™½ç„¶å›¾ä¸­ä»…æè¿°äº†ä¸€ä¸ªå­é—®é¢˜ï¼ˆ`i=2`ï¼Œæˆ–è€…è¯´`i=r-1`ï¼‰ï¼Œä½†ä¸éš¾å‘ç°å¯¹äºå…¶ä»–çš„ `i`âˆˆ`[0, r-1]` è¿™ä¸€è®¨è®ºéƒ½æ˜¯æˆç«‹çš„ã€‚è¿™ä¹Ÿï¼ˆä¸ä¸¥æ ¼åœ°ï¼‰è¯´æ˜äº†è¿™ä¸€ç®—æ³•çš„ç¡®å¯ä»¥éå†æ‰€æœ‰çš„å¯èƒ½æ’åˆ—ã€‚è¾“å‡ºé¡ºåºä¸ºå­—å…¸åºï¼Œåˆ™æ˜¯å› ä¸ºæ¯ä¸ª tick ä¸­äº¤æ¢å…ƒç´ æ—¶éƒ½ç»´æŠ¤äº† backlog ä¸­çš„ç›¸å¯¹é¡ºåºã€‚

è¿™éƒ¨åˆ†è®¨è®ºæœ‰äº›å¤æ‚ï¼Œå¦‚æœä¸å¤ªç†è§£ï¼ˆæˆ–è€…ä¸å®Œå…¨ä¿¡æœï¼‰çš„è¯ï¼Œå¯ä»¥è‡ªå·±å¤šåŠ ç‚¹ `print` ï¼Œæˆ–è€…æ‰‹åŠ¨åœ¨çº¸ä¸Šæ‰§è¡Œæ„Ÿå—ä¸€ä¸‹ã€‚

### é‡æ–°å®ç°

ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†è¿™ä¸ªç®—æ³•çš„åŸç†ï¼Œé‡æ–°å®ç°å…¶åŸå§‹é€’å½’ç‰ˆæœ¬ä¹Ÿå°±ä¸éš¾äº†ã€‚

- é€’å½’è°ƒç”¨æ—¶ï¼Œéœ€è¦ä¸€ä¸ªå‚æ•°æŒ‡å®šå½“å‰ä¿®æ”¹çš„å…ƒç´ ï¼ˆchangingï¼‰çš„ index
- åœ¨æ¯ä¸€å±‚è°ƒç”¨ä¸­ï¼Œäº¤æ¢ changing å’Œ backlog ä¸­çš„æ‰€æœ‰é¡¹ï¼Œå¹¶åœ¨æ¯æ¬¡äº¤æ¢ï¼ˆåšå‡ºé€‰æ‹©ï¼‰åè§¦å‘ä¸‹ä¸€å±‚
- å¦‚æœ backlog ä¸­çš„æ‰€æœ‰å¯é€‰é¡¹éƒ½å·²ç»è¢«é€‰æ‹©ï¼ˆæ¶ˆè€—ï¼‰äº†ï¼Œå°±æŠŠå½“å‰çš„ changing ç§»åˆ° backlog åï¼Œä»¥æ’¤é”€è¿™ä¸€å±‚çš„é€‰æ‹©

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯èƒ½çš„ Python é‡æ–°å®ç°ã€‚

```python
## a reimplementation of `itertools.permutation`

# helpers
def swap(list, i, j):
    list[i], list[j] = list[j], list[i]

def move_to_last(list, i):
    list[i:] = list[i+1:] + [list[i]]

def print_first_n_element(list, n):
    print("".join(list[:n]))

# backtracking dfs
def permutations(list, r, changing_index):
    if changing_index == r:
        # we've reached the deepest level
        print_first_n_element(list, r)
        return
    
    # a pseudo `tick`
    # process initial permutation
    # which is just doing nothing (using the initial value)
    permutations(list, r, changing_index + 1)

    # note: initial permutaion has been outputed, thus the minus 1
    remaining_choices = len(list) - 1 - changing_index
    # for (i=1;i<=remaining_choices;i++)
    for i in range(1, remaining_choices+1):
        # `tick` phases
        
        # make one swap
        swap_idx = changing_index + i
        swap(list, changing_index, swap_idx)
        # finished one move at current level, now go deeper
        permutations(list, r, changing_index + 1)
    
    # `reset` phase
    move_to_last(list, changing_index)

# wrapper
def permutations_wrapper(list, r):
    permutations(list, r, 0)

# main
if __name__ == "__main__":
    my_list = ["A", "B", "C", "D"]
    permutations_wrapper(my_list, 2)
```

### é€’å½’è½¬å¾ªç¯ä¼˜åŒ–

å‡ºäºæ€§èƒ½å’Œå®‰å…¨ï¼ˆé˜²æ­¢çˆ†æ ˆï¼‰çš„è€ƒé‡ï¼Œæˆ‘ä»¬ä¼šæƒ³å°†è¿™ä¸ªç®—æ³•çš„é€’å½’ç‰ˆæœ¬è½¬æ¢æˆå¾ªç¯ç‰ˆæœ¬ã€‚è¿™éœ€è¦æˆ‘ä»¬ç”¨æ ˆæ‰‹åŠ¨ç»´æŠ¤æ¯ä¸€å±‚é€’å½’çš„ç›¸å…³çŠ¶æ€ï¼ŒåŒ…æ‹¬é€’å½’ä¸­çš„å˜é‡å’Œä¸‹ä¸€æ¬¡æ‰§è¡Œçš„å¼€å§‹ä½ç½®ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¯¹è¿™ä¸ªç®—æ³•è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤çš„çŠ¶æ€å¹¶ä¸å¤šã€‚

- `r` æ˜¯å·²çŸ¥ä¸”å›ºå®šçš„ï¼Œå³æ ˆçš„æœ€å¤§æ·±åº¦ä¸º `r`ï¼Œå› æ­¤å¯ä»¥ç”¨ä¸€ä¸ªå›ºå®šå¤§å°çš„åˆ—è¡¨æ¥è¡¨ç¤ºæ ˆä¸­ï¼ˆæ¯ä¸€å±‚é€’å½’ï¼‰çš„çŠ¶æ€ã€‚

- `changing_idx` æ˜¯æ¯å±‚é€’å½’çš„è¾“å…¥ï¼Œä»£è¡¨å½“å‰å±‚å˜åŒ–çš„å…ƒç´ ã€‚`changing_idx` å¯ä»¥ä»æ ˆçš„æ·±åº¦è®¡ç®—å‡ºæ¥ï¼Œæ ˆåº•ä¸º 0ï¼Œå†ä¸Šä¸€å±‚ä¸º 1... å› æ­¤å®é™…ä¸Šä¸éœ€è¦ç»´æŠ¤ã€‚
- `i` æˆ– `swap_idx` ä¸ºä¸‹ä¸€æ¬¡äº¤æ¢çš„ç›®æ ‡å…ƒç´  indexã€‚è¿™æ— æ³•ä»æ ˆæœ¬èº«çš„ä¿¡æ¯è®¡ç®—å¾—åˆ°ï¼Œéœ€è¦æˆ‘ä»¬ç»´æŠ¤ã€‚
- è¿›å…¥æˆ–é‡æ–°å›åˆ°å½“å‰å±‚é€’å½’çš„å¼€å§‹ä½ç½®ï¼Œå¯ä»¥ç”¨ `i` æˆ– `swap_idx` æ¨ç®—å¾—åˆ°ï¼šå¦‚æœè¿˜æœ‰å‰©ä½™å¯é€‰é¡¹ï¼Œåˆ™è·³è½¬åˆ° tickï¼›åä¹‹è·³è½¬åˆ° reset

åŸºäºä¸Šæ–‡åˆ†æï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬éœ€è¦ç»´æŠ¤çš„æ ˆæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š

- é•¿åº¦å›ºå®šä¸º `r`
- æ¯ä¸ªå…ƒç´ ä¸Šç»´æŠ¤ä¸‹ä¸€æ¬¡äº¤æ¢çš„ç›®æ ‡å…ƒç´  index

å›å¤´çœ‹çœ‹ï¼Œè¿™å®é™…ä¸Šå°±æ˜¯ `cycles`ã€‚åœ¨ã€Œå‰©ä½™å¯èƒ½æ•°ã€çš„èº«ä»½ä¹‹å¤–ï¼Œ`cycles` ä¹Ÿæ‰¿æ‹…èµ·äº†ç»´æŠ¤é€’å½’çŠ¶æ€çš„èŒè´£ã€‚è€Œä½œè€…å·§å¦™åˆ©ç”¨äº† Python åˆ—è¡¨ç´¢å¼•å¯ä»¥ä¸ºè´Ÿæ•°ä»åå¾€å‰çš„ç‰¹æ€§ï¼Œç»Ÿä¸€äº† `cycles` çš„ä¸¤é¢ã€‚



è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†å¯¹è¿™ä¸€ç®—æ³•çš„åˆ†æã€‚ğŸ‰



## ç›¸å…³é“¾æ¥

- Python `itertools.permutation` æ–‡æ¡£ï¼š[itertools --- ä¸ºé«˜æ•ˆå¾ªç¯è€Œåˆ›å»ºè¿­ä»£å™¨çš„å‡½æ•° â€” Python 3.10.4 æ–‡æ¡£](https://docs.python.org/zh-cn/3/library/itertools.html#itertools.permutations)
- CPython `itertools.permutation` å®ç°ï¼š[cpython/itertoolsmodule.c at main Â· python/cpython (github.com)](https://github.com/python/cpython/blob/main/Modules/itertoolsmodule.c#L3212)
- Stack Overflow ç›¸å…³é—®é¢˜ï¼š[algorithm for python itertools.permutations - Stack Overflow](https://stackoverflow.com/questions/2565619/algorithm-for-python-itertools-permutations)
- çŸ¥ä¹ç›¸å…³é—®é¢˜ï¼š[å¦‚ä½•ç†è§£Python itertools.permutationsä¸­çš„å…¨æ’åˆ—ç®—æ³•ï¼Ÿ - çŸ¥ä¹ (zhihu.com)](https://www.zhihu.com/question/440688033)
- æˆ‘ç»™ Stack Overflow é—®é¢˜å†™çš„å›ç­”ï¼š[algorithm for python itertools.permutations - Stack Overflow](https://stackoverflow.com/questions/2565619/algorithm-for-python-itertools-permutations/72177891#72177891)
